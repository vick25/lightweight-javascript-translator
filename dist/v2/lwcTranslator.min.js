"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}
/**
 * @author codingsamuel
 * @license MIT
 * @version 2.1.1
 * @copyright codingsamuel 2019
 */var LwcTranslator=function(){function t(e){_classCallCheck(this,t),this.settings={querySelector:e.querySelector||"html",translationSettings:e.translationSettings||"/assets/config/translations.json",translationFolder:e.translationFolder||"/assets/config/translations/",initialLanguageCode:e.initialLanguageCode||"en-GB",autoTranslate:e.autoTranslate||!1,onTranslationSettingsLoaded:e.onTranslationSettingsLoaded||function(){},onTranslationLoaded:e.onTranslationLoaded||function(){},onError:e.onError||function(){},store:{useCustom:Boolean,key:String,mode:String,customCallback:{get:Function,set:Function}}},e.store?this.settings.store={useCustom:e.store.useCustom||!1,key:e.store.key||"currLang",mode:e.store.mode||"localStorage",customCallback:e.store.customCallback?{get:e.store.customCallback.get||function(){},set:e.store.customCallback.set||function(){}}:{get:function(){},set:function(){}}}:this.settings.store={useCustom:!1,key:"currLang",mode:"localStorage",customCallback:{get:function(){},set:function(){}}},this.init()}return _createClass(t,[{key:"_contains",value:function(t){try{var n=document.querySelectorAll("*");return Array.prototype.filter.call(n,function(e){return RegExp(t).test(e.textContent)})}catch(t){this.settings.onError.call(this._handleError(e))}}},{key:"_replaceAll",value:function(t,e,n){try{return t.split(e).join(n)}catch(t){this.settings.onError.call(this._handleError(t))}}},{key:"_prepareRequest",value:function(t){try{var e=new XMLHttpRequest;return e.open("GET",t),e.send(),e}catch(t){this.settings.onError.call(this,this._handleError(t))}}},{key:"_handleError",value:function(t){try{var e={originalError:Object,handleError:String,errorCode:Number};return"string"==typeof t?(e.originalError=t,e.handleError=t,e.errorCode=400):"object"===_typeof(t)&&(e.originalError=t,t.message?(e.handleError=t.message,e.errorCode=400):t.status&&t.response?(e.handleError=t.responseText,e.errorCode=t.status):(e.handleError=t,e.errorCode=400)),e}catch(t){console.error(t)}}},{key:"_loadTranslationFile",value:function(t,e){var n=this;try{var r=this.getCurrentLanguage();if((e.translations||[]).filter(function(t){return t===r.langCode})[0]){var s=this._prepareRequest(this.settings.translationFolder+t+"/"+e.dir+"/"+r.langCode+".json");s.onreadystatechange=function(t){if(4===s.readyState&&200===s.status){var e=JSON.parse(s.responseText),r=e.content;n.translate(r),n.settings.onTranslationLoaded.call(n,e)}else 4===s.readyState&&n.settings.onError.call(n,n._handleError(s))}}else this.settings.onError.call(this,this._handleError("No translation found for page ["+e.dir+"]!"))}catch(t){this.settings.onError.call(this,this._handleError(t))}}},{key:"_loadTranslations",value:function(t,e,n){try{var r=t.pagesDir||"pages",s=t.partialsDir||"partials",a=t.partials||[],o=e.partials||[],i=(u=[],o.forEach(function(t,e){var n=a.filter(function(e){return e.dir===t})[0];n&&u.push(n)}),u);if(i.length!=o.length)this.settings.onError.call(this,this._handleError("Not all Partials for the page ["+n+"] were found. Please check your settings file!"));else for(var l=0;l<i.length;l++)this._loadTranslationFile(s,i[l]);this._loadTranslationFile(r,e)}catch(t){this.settings.onError.call(this,this._handleError(t))}var u}},{key:"setRegex",value:function(t){this._regex=t}},{key:"getRegex",value:function(){return this._regex}},{key:"setSupportedLanguages",value:function(t){this._supportedLanguages=t}},{key:"getSupportedLanguages",value:function(){return this._supportedLanguages}},{key:"setCurrentLanguage",value:function(t){if(this.settings.store.useCustom)this.settings.store.customCallback.set.call(this,t);else{var e={name:"English",langShort:"en",langCode:"en-GB"},n=JSON.stringify(this.getSupportedLanguages()&&this.getSupportedLanguages().filter(function(e){return e.langCode===t})[0]||e);switch(this.settings.store.mode){case"localStorage":window.localStorage.setItem(this.settings.store.key,n);break;case"cookie":document.cookie=this.settings.store.key+"="+n+";path=/"}}}},{key:"getCurrentLanguage",value:function(){var t,e=this;if(this.settings.store.useCustom)return this.settings.store.customCallback.get.call(this);switch(this.settings.store.mode){case"localStorage":t=window.localStorage.getItem(this.settings.store.key);break;case"cookie":document.cookie.split(";").forEach(function(n,r){var s=n.split("=");s[0]===e.settings.store.key&&(t=s[1])})}return t?JSON.parse(t):null}},{key:"getCurrentPage",value:function(){var t=window.location.pathname;return t=(t=t.replace(/\.[^/.]+$/,"")).substring(1,t.length)}},{key:"setTranslationSettings",value:function(t){this._translationSettings=t}},{key:"getTranslationsSettings",value:function(){return this._translationSettings}},{key:"init",value:function(){try{var t=this.settings;this.loadSettings(t.translationSettings)}catch(t){this.settings.onError.call(this,this._handleError(t))}}},{key:"loadSettings",value:function(t){var e=this;try{var n=this._prepareRequest(t);n.onreadystatechange=function(t){if(4===n.readyState&&200===n.status){var r=JSON.parse(n.responseText);e.setSupportedLanguages(r.supported),e.setRegex(r.regex||"\\{\\{(.*?)\\}\\}"),e.setTranslationSettings(r),e.getCurrentLanguage()||e.setCurrentLanguage(e.settings.initialLanguageCode);var s=e.getCurrentPage();e.settings.autoTranslate&&(console.warn("Auto translate is still in beta, because it still can't recognize the correct path. Please use load the translation manually in the onTranslationSettingsLoad callback."),e.load(s)),e.settings.onTranslationSettingsLoaded.call(e,r)}else 4===n.readyState&&e.settings.onError.call(e,e._handleError(n))}}catch(t){this.settings.onError.call(this,this._handleError(t))}}},{key:"load",value:function(t){try{var e=this.getTranslationsSettings(),n=e.pages.filter(function(e){return e.dir===t})[0];n?this._loadTranslations(e,n,t):this.settings.onError.call(this,this._handleError("Page ["+t+"] not found in settings!"))}catch(t){this.settings.onError.call(this,this._handleError(t))}}},{key:"translate",value:function(t){var e=this;try{var n=this.getCurrentLanguage();if(t){var r=document.querySelector(this.settings.querySelector);document.querySelector("html").setAttribute("lang",n.langShort);var s=new RegExp(this.getRegex(),"g"),a=r.innerHTML.match(s);a&&a.forEach(function(n,r){var a=e._contains(n),o=a[a.length-1],i=(s=new RegExp(e.getRegex(),"g")).exec(n);if(o&&i){var l=i[1].split("."),u=t;l.forEach(function(t){u[t]&&(u=u[t])}),"string"==typeof u&&(o.innerHTML=e._replaceAll(o.innerHTML,n,u))}else e.settings.onError.call(e,e._handleError("Could not translate ["+n+"]"))})}else this.settings.onError.call(this,this._handleError("translation content is not defined. Please check your translation file for ["+n.langCode+".json]"))}catch(t){this.settings.onError.call(this,this._handleError(t))}}}]),t}();